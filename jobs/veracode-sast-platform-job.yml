# File: veracode-sast-platform-job.yml

parameters:
- name: ArtifactName
  default: ''
  type: string

jobs:       
 - job: SAST_Security_Testing
   displayName: Static Analysis Security Testing

   steps:

   # step to validate required parameters
   - bash: |
        if [ -z "$ArtifactName" ]; then
          echo "##vso[task.logissue type=error;]Missing template parameter \"ArtifactName\""
          echo "##vso[task.complete result=Failed;]"
        fi

   - task: DownloadPipelineArtifact@2
     inputs:
        artifact: ${{ parameters.ArtifactName }}

   - bash: echo 'Veracode Platform SAST'
   - bash: echo ArtifactName: ${{ parameters.ArtifactName }}
   - bash: ls -la

   #- task: Veracode@3
   #  inputs:
   #     ConnectionDetailsSelection: 'Endpoint'
   #     AnalysisService: 'Veracode SaaS Connection'
        # apiId: '$(VERACODE_ID)'
        # apiKey: '$(VERACODE_KEY)'
   #     veracodeAppProfile: '$(system.teamProject)'
   #     version: '$(build.buildNumber)'
   #     filepath: '$(Pipeline.Workspace)'  #$(build.artifactstagingdirectory)
   #     sandboxName: 'Development Sandbox'
   #     failBuildIfUploadAndScanBuildStepFails: true
   #     importResults: true
       # failBuildOnPolicyFail: true
       # maximumWaitTime: '360'
